IssueComment {issueCommentUpdatedAt = GithubDate {fromGithubDate = 2012-12-12 15:45:21 UTC}, issueCommentUser = GithubUser {githubOwnerAvatarUrl = "https://secure.gravatar.com/avatar/004e831787204c4a5be80c5f55227764?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png", githubOwnerLogin = "grooverdan", githubOwnerUrl = "https://api.github.com/users/grooverdan", githubOwnerId = 462287, githubOwnerGravatarId = "004e831787204c4a5be80c5f55227764"}, issueCommentUrl = "https://api.github.com/repos/fail2ban/fail2ban/issues/comments/11293469", issueCommentCreatedAt = GithubDate {fromGithubDate = 2012-12-12 15:33:04 UTC}, issueCommentBody = "\r\n> sorry if I am missing -- what about actionstart/stop which have no `<ip*>`? do you want to append some fake # `<ip6>` to them just to demarcate the family?\r\n\r\nIt works it out on missing tags. So if there's none missing it runs it regardless. The command isn't dependant on ip family so its run.\r\n\r\nfor actionstart would be:\r\n\r\n`actionstart = iptables -N <fail2ban>-name\r\n                     iptables -I <chain> -p <protocol> --dport <port> -j fail2ban-<name>\r\n                    ip6tables -N <fail2ban>-name\r\n                    ip6tables -I <chain> -p <protocol> --dport <port> -j fail2ban-<name>`\r\n\r\nall are run. Though faking # `<ip6>` is possible I don't see where it would be used.\r\n\r\n> I am a bit against this approach solely because of the need to duplicate majority of the action lines, while changing only iptables -> iptables6.\r\n\r\nIt may be duplicate but its explicit to the admin what happens. This has some readability aspects for sysadmins.\r\n\r\nactioncheck = fail2ban-iptables -n -L <chain> | grep -q fail2ban-`<name>`\r\n\r\nWhat does this actually check? With the wrapper script it checks that the one of the chains has a fail2ban-`<name>` which may not be what's expected.\r\n\r\n> Also some actions might be agnostic to the IP family, i.e. have the same command for both, it would be really silly to duplicate those especially\r\n\r\nAgnostic commands aren't duplicated. Like action.d/complain.conf will require not changes (except for `<STDIN>` becoming a tag).  `<ip>` becomes the v4 or v6 address as appropriate.\r\n\r\n> but the rest of the code (without family-tag matching) is useful in general since we discussed (or I blurbed)\r\n\r\nHopefully I covered most of the lower level  (in a crude untested way).\r\n\r\nIts not so much family-tag matching as don't run a command with unfilled tags.\r\n\r\n> about necessity to specify \"supported\" address families (so some action files could be ignored entirely if address family is not matching),\r\n\r\nand/or swap `<ip>` to `<ip4>` until they are.\r\n\r\n> and possibly just make `<ipfamily>` tag exposed to be passed to the underlying tool\r\n\r\ncould. Just will have a lot of the following which would be more explicit.\r\n\r\n\r\n`[ \"<ipfamily>\" -eq \"inet\" ] && iptables ...`\r\n`[ \"<ipfamily>\" -eq \"inet6\" ] && ip6tables ...`\r\n\r\nperhaps add `<cidr>` for config/action.d/ipfilter.conf too.\r\n\r\n(after that escaping friz I'm going to bed)", issueCommentId = 11293469}