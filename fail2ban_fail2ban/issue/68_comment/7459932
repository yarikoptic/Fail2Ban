IssueComment {issueCommentUpdatedAt = GithubDate {fromGithubDate = 2012-08-02 16:09:36 UTC}, issueCommentUser = GithubUser {githubOwnerAvatarUrl = "https://secure.gravatar.com/avatar/6a424256589825f609fd3477144355a0?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-user-420.png", githubOwnerLogin = "yarikoptic", githubOwnerUrl = "https://api.github.com/users/yarikoptic", githubOwnerId = 39889, githubOwnerGravatarId = "6a424256589825f609fd3477144355a0"}, issueCommentUrl = "https://api.github.com/repos/fail2ban/fail2ban/issues/comments/7459932", issueCommentCreatedAt = GithubDate {fromGithubDate = 2012-08-02 16:09:36 UTC}, issueCommentBody = "also we would need to anchor \ngrep -i \"[\\t ]<ip>[\\t ]\"\nto not match others from the same or not networks... and ideally '.'\nshould be escaped since otherwise would match even more IPs ;)\n\n\nOn Thu, 02 Aug 2012, Andy Fragen wrote:\n\n> The argument taken by the ipfw delete is rulenum. actionunban = ipfw delete `ipfw list | grep -i <ip> | awk '{print $1;}'` grabs the rulenum, which is why when no rulenum is set and ipfw automatically adds the same rulenum, every unban causes all the rules to delete.\n\n> From ipfw man page\n\n>  rule_number\n>              Each rule is associated with a rule_number in the range 1..65535, with the latter reserved for the\n>              default rule.  Rules are checked sequentially by rule number.  Multiple rules can have the same num-\n>              ber, in which case they are checked (and listed) according to the order in which they have been\n>              added.  If a rule is entered without specifying a number, the kernel will assign one in such a way\n>              that the rule becomes the last one before the default rule.  Automatic rule numbers are assigned by\n>              incrementing the last non-default rule number by the value of the sysctl variable\n>              net.inet.ip.fw.autoinc_step which defaults to 100.  If this is not possible (e.g. because we would go\n>              beyond the maximum allowed rule number), the number of the last non-default value is used instead.\n\n> ---\n> Reply to this email directly or view it on GitHub:\n> https://github.com/fail2ban/fail2ban/pull/68#issuecomment-7459741\n\n\n-- \nYaroslav O. Halchenko\nPostdoctoral Fellow,   Department of Psychological and Brain Sciences\nDartmouth College, 419 Moore Hall, Hinman Box 6207, Hanover, NH 03755\nPhone: +1 (603) 646-9834                       Fax: +1 (603) 646-1419\nWWW:   http://www.linkedin.com/in/yarik", issueCommentId = 7459932}